<app-navbar></app-navbar>

<div class="container mt-4">
    <div class="card" id="select">
        <div class="card-body">
            <h5 class="card-title mb-3">Select Policy</h5>
            <ng-select [items]="policies" [searchable]="true" [clearable]="true" placeholder="Select a policy number"
                (change)="onPolicySelect()" [(ngModel)]="selectedPolicy" id="policySelect" aria-label="Policy Number Selection">
            </ng-select>
            <div *ngIf="errorOccurred" #nopolicy>
                <p class="text-danger">{{ errMsg }}</p>
            </div>
        </div>
    </div>
</div>

<ng-template #noValue>
    <span class="text-warning">Not provided</span>
</ng-template>

<div class="container mt-4">
    <ul class="nav nav-tabs" id="policyTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview"
                type="button" role="tab" aria-controls="overview" aria-selected="true">
                Policy Holder Details
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button"
                role="tab" aria-controls="details" aria-selected="false">
                Policy Details
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="documents-tab" data-bs-toggle="tab" data-bs-target="#documents"
                type="button" role="tab" aria-controls="documents" aria-selected="false">
                Description
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="vehicle-tab" data-bs-toggle="tab" data-bs-target="#vehicle" type="button"
                role="tab" aria-controls="vehicle" aria-selected="false">
                Vehicle Details
            </button>
        </li>
    </ul>

    <div class="tab-content p-3 border border-top-0 rounded-bottom shadow-sm" id="policyTabContent">

        <!-- Policy Holder Details Tab -->
        <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
            <div *ngIf="policyDetails">
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title mb-3">Personal Information</h5>
                                <dl>
                                    <dt>First Name:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.policyholder?.firstName; else noValue">
                                            {{ policyDetails.policyholder.firstName }}
                                        </span>
                                    </dd>
                                    <dt>Last Name:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.policyholder?.lastName; else noValue">
                                            {{ policyDetails.policyholder.lastName }}
                                        </span>
                                    </dd>
                                    <dt>Mobile No:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.policyholder?.mobileNo; else noValue">
                                            {{ policyDetails.policyholder.mobileNo }}
                                        </span>
                                    </dd>
                                    <dt>Email:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.policyholder?.email; else noValue">
                                            {{ policyDetails.policyholder.email }}
                                        </span>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title mb-3">Address</h5>
                                <dl>
                                    <dt>Address Line 1:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.policyholder?.addressLine1; else noValue">
                                            {{ policyDetails.policyholder.addressLine1 }}
                                        </span>
                                    </dd>
                                    <dt>Address Line 2:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.policyholder?.addressLine2; else noValue">
                                            {{ policyDetails.policyholder.addressLine2 }}
                                        </span>
                                    </dd>
                                    <dt>City:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.policyholder?.city; else noValue">
                                            {{ policyDetails.policyholder.city }}
                                        </span>
                                    </dd>
                                    <dt>State:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.policyholder?.state; else noValue">
                                            {{ policyDetails.policyholder.state }}
                                        </span>
                                    </dd>
                                    <dt>Pincode:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.policyholder?.pincode; else noValue">
                                            {{ policyDetails.policyholder.pincode }}
                                        </span>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title mb-3">Identity Details</h5>
                                <dl>
                                    <dt>Aadhar Number:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.policyholder?.Aadhar; else noValue">
                                            {{ policyDetails.policyholder.Aadhar }}
                                        </span>
                                    </dd>
                                    <dt>License Number:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.policyholder?.licenseNumber; else noValue">
                                            {{ policyDetails.policyholder.licenseNumber }}
                                        </span>
                                    </dd>
                                    <dt>PAN Number:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.policyholder?.panNumber; else noValue">
                                            {{ policyDetails.policyholder.panNumber }}
                                        </span>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title mb-3">Bank Details</h5>
                                <dl>
                                    <dt>Account Number:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.policyholder?.accountNumber; else noValue">
                                            {{ policyDetails.policyholder.accountNumber }}
                                        </span>
                                    </dd>
                                    <dt>IFSC Code:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.policyholder?.ifscCode; else noValue">
                                            {{ policyDetails.policyholder.ifscCode }}
                                        </span>
                                    </dd>
                                    <dt>Bank Name:</dt>
                                    <dd>State Bank of India</dd>
                                    <dt>Bank Address:</dt>
                                    <dd>SBI Main Branch, Kerala</dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Policy Details Tab -->
        <div class="tab-pane fade" id="details" role="tabpanel" aria-labelledby="details-tab">
            <div *ngIf="policyDetails">
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title mb-3">Policy Information</h5>
                                <dl>
                                    <dt>Policy Number:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.policyDetails?.policyNumber; else noValue">
                                            {{ policyDetails.policyDetails.policyNumber }}
                                        </span>
                                    </dd>
                                    <dt>Policy Effective Date:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.policyDetails?.policyEffectiveDt; else noValue">
                                            {{ policyDetails.policyDetails.policyEffectiveDt | date }}
                                        </span>
                                    </dd>
                                    <dt>Policy Expiration Date:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.policyDetails?.policyExpirationDt; else noValue">
                                            {{ policyDetails.policyDetails.policyExpirationDt | date }}
                                        </span>
                                    </dd>
                                    <dt>Term:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.policyDetails?.term; else noValue">
                                            {{ policyDetails.policyDetails.term }} year(s)
                                        </span>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title mb-3">Policy Status</h5>
                                <dl>
                                    <dt>Status:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.policyDetails?.status; else noValue">
                                            {{ policyDetails.policyDetails.status }}
                                        </span>
                                    </dd>
                                    <dt>Total Premium:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.policyDetails?.totalPremium; else noValue">
                                            ₹{{ policyDetails.policyDetails.totalPremium }}
                                        </span>
                                    </dd>
                                    <dt>Payment Plan:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.policyDetails?.payPlan; else noValue">
                                            {{ policyDetails.policyDetails.payPlan }}
                                        </span>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Description Tab -->
        <div class="tab-pane fade" id="documents" role="tabpanel" aria-labelledby="documents-tab">
            <div *ngIf="policyDetails?.coverageDetails?.description">
                <div class="row g-4">
                    <div class="col-md-12">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title mb-3">Coverage Details</h5>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item"
                                        *ngFor="let desc of policyDetails.coverageDetails.description.split(',')">
                                        {{ desc.trim() }}
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vehicle Details Tab -->
        <div class="tab-pane fade" id="vehicle" role="tabpanel" aria-labelledby="vehicle-tab">
            <div *ngIf="policyDetails">
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title mb-3">Vehicle & Policy Info</h5>
                                <dl>
                                    <dt>Policy Number:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.vehicleDetails?.policyNumber; else noValue">
                                            {{ policyDetails.vehicleDetails.policyNumber }}
                                        </span>
                                    </dd>
                                    <dt>Vehicle Type:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.vehicleDetails?.vehicleType; else noValue">
                                            {{ policyDetails.vehicleDetails.vehicleType }}
                                        </span>
                                    </dd>
                                    <dt>Registration Number:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.vehicleDetails?.registrationNumber; else noValue">
                                            {{ policyDetails.vehicleDetails.registrationNumber }}
                                        </span>
                                    </dd>
                                    <dt>Date of Purchase:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.vehicleDetails?.dateOfPurchase; else noValue">
                                            {{ policyDetails.vehicleDetails.dateOfPurchase | date }}
                                        </span>
                                    </dd>
                                    <dt>RTO Name:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.vehicleDetails?.rtoName; else noValue">
                                            {{ policyDetails.vehicleDetails.rtoName }}
                                        </span>
                                    </dd>
                                    <dt>City:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.vehicleDetails?.city; else noValue">
                                            {{ policyDetails.vehicleDetails.city }}
                                        </span>
                                    </dd>
                                    <dt>State:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.vehicleDetails?.state; else noValue">
                                            {{ policyDetails.vehicleDetails.state }}
                                        </span>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title mb-3">Vehicle Specifications</h5>
                                <dl>
                                    <dt>Brand:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.vehicleDetails?.brand; else noValue">
                                            {{ policyDetails.vehicleDetails.brand }}
                                        </span>
                                    </dd>
                                    <dt>Model Name:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.vehicleDetails?.modelName; else noValue">
                                            {{ policyDetails.vehicleDetails.modelName }}
                                        </span>
                                    </dd>
                                    <dt>Variant:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.vehicleDetails?.variant; else noValue">
                                            {{ policyDetails.vehicleDetails.variant }}
                                        </span>
                                    </dd>
                                    <dt>Body Type:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.vehicleDetails?.bodyType; else noValue">
                                            {{ policyDetails.vehicleDetails.bodyType }}
                                        </span>
                                    </dd>
                                    <dt>Fuel Type:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.vehicleDetails?.fuelType; else noValue">
                                            {{ policyDetails.vehicleDetails.fuelType }}
                                        </span>
                                    </dd>
                                    <dt>Transmission Type:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.vehicleDetails?.transmissionType; else noValue">
                                            {{ policyDetails.vehicleDetails.transmissionType }}
                                        </span>
                                    </dd>
                                    <dt>Color:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.vehicleDetails?.color; else noValue">
                                            {{ policyDetails.vehicleDetails.color }}
                                        </span>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title mb-3">Technical Details</h5>
                                <dl>
                                    <dt>Chasis Number:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.vehicleDetails?.chasisNumber; else noValue">
                                            {{ policyDetails.vehicleDetails.chasisNumber }}
                                        </span>
                                    </dd>
                                    <dt>Engine Number:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.vehicleDetails?.engineNumber; else noValue">
                                            {{ policyDetails.vehicleDetails.engineNumber }}
                                        </span>
                                    </dd>
                                    <dt>Cubic Capacity:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.vehicleDetails?.cubicCapacity; else noValue">
                                            {{ policyDetails.vehicleDetails.cubicCapacity }}
                                        </span>
                                    </dd>
                                    <dt>Seating Capacity:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.vehicleDetails?.seatingCapacity; else noValue">
                                            {{ policyDetails.vehicleDetails.seatingCapacity }}
                                        </span>
                                    </dd>
                                    <dt>Year of Manufacture:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.vehicleDetails?.yearOfManufacture; else noValue">
                                            {{ policyDetails.vehicleDetails.yearOfManufacture }}
                                        </span>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title mb-3">Valuation</h5>
                                <dl>
                                    <dt>IDV:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.vehicleDetails?.idv; else noValue">
                                            ₹{{ policyDetails.vehicleDetails.idv }}
                                        </span>
                                    </dd>
                                    <dt>Ex-Showroom Price:</dt>
                                    <dd>
                                        <span *ngIf="policyDetails?.vehicleDetails?.exShowroomPrice; else noValue">
                                            ₹{{ policyDetails.vehicleDetails.exShowroomPrice }}
                                        </span>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>